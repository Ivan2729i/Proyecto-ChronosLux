{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ChronosLux - Premium Timepieces{% endblock %}</title>
    <meta name="description" content="Discover the finest collection of luxury watches combining elegance and precision">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body class="font-sans antialiased">

    <header class="sticky top-0 z-50 custom-bg-primary custom-text-primary-foreground shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <a href="{% url 'home' %}" class="flex items-center space-x-2">
                    <div class="w-8 h-8 custom-bg-secondary rounded-full flex items-center justify-center">
                        <span class="custom-text-secondary-foreground font-serif font-black text-sm">C</span>
                    </div>
                    <span class="font-serif font-black text-xl">ChronosLux</span>
                </a>

                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="nav-link font-medium">Inicio</a>
                    <a href="#catalog" class="nav-link font-medium">Catálogo</a>
                    <a href="#exclusive" class="nav-link font-medium">Exclusivos</a>
                    <a href="#contact" class="nav-link font-medium">Contacto</a>
                </nav>

                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-2">
                        <input type="text" placeholder="Buscar relojes..." class="w-64 px-3 py-2 rounded-md bg-white text-gray-900">
                        <button class="px-3 py-2 custom-bg-secondary custom-text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors"
                        title="Buscar">
                            <i data-lucide="search" class="w-4 h-4"></i>
                        </button>
                    </div>

                    <button id="user-icon-btn" class="relative p-2 hover:bg-primary-foreground/10 rounded-md transition-colors" title="Usuario">
                        <i data-lucide="user" class="w-5 h-5"></i>
                    </button>

                    <button id="cart-btn" class="relative p-2 hover:bg-primary-foreground/10 rounded-md transition-colors" title="Carrito">
                        <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 custom-bg-secondary custom-text-secondary-foreground min-w-5 h-5 flex items-center justify-center text-xs rounded-full hidden">0</span>
                    </button>

                    <button id="mobile-menu-btn" class="md:hidden p-2 hover:bg-primary-foreground/10 rounded-md transition-colors">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div id="mobile-menu" class="md:hidden py-4 border-t border-primary-foreground/20 hidden">
                <nav class="flex flex-col space-y-4">
                    <a href="#home" class="nav-link font-medium">Inicio</a>
                    <a href="#catalog" class="nav-link font-medium">Catálogo</a>
                    <a href="#exclusive" class="nav-link font-medium">Exclusivos</a>
                    <a href="#contact" class="nav-link font-medium">Contacto</a>
                    <div class="flex items-center space-x-2 pt-2">
                        <input type="text" placeholder="Buscar relojes..." class="flex-1 px-3 py-2 rounded-md bg-white text-gray-900">
                        <button class="px-3 py-2 custom-bg-secondary custom-text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                            <i data-lucide="search" class="w-4 h-4"></i>
                        </button>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    {% block content %}
    {% endblock %}

    <footer id="contact" class="custom-bg-foreground text-white py-16">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-2 mb-6">
                        <div class="w-10 h-10 custom-bg-secondary rounded-full flex items-center justify-center">
                            <span class="custom-text-secondary-foreground font-serif font-black text-lg">C</span>
                        </div>
                        <span class="font-serif font-black text-2xl">ChronosLux</span>
                    </div>
                    <p class="text-gray-300 leading-relaxed mb-6 max-w-md">
                        Más de 50 años de experiencia en relojería de lujo. Somos especialistas en las marcas más prestigiosas del mundo.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-secondary transition-colors">
                            <i data-lucide="facebook" class="w-5 h-5"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-secondary transition-colors">
                            <i data-lucide="instagram" class="w-5 h-5"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-secondary transition-colors">
                            <i data-lucide="twitter" class="w-5 h-5"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="font-serif font-bold text-lg mb-4">Enlaces Rápidos</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="#home" class="hover:text-secondary transition-colors">Inicio</a></li>
                        <li><a href="#catalog" class="hover:text-secondary transition-colors">Catálogo</a></li>
                        <li><a href="#exclusive" class="hover:text-secondary transition-colors">Exclusivos</a></li>
                        <li><a href="#contact" class="hover:text-secondary transition-colors">Contacto</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-serif font-bold text-lg mb-4">Contacto</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li class="flex items-center space-x-2">
                            <i data-lucide="phone" class="w-4 h-4"></i>
                            <span>+1 (555) 123-4567</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="mail" class="w-4 h-4"></i>
                            <span>info@chronosluxury.com</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                            <span>ITVER JP Silva, Veracruz</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-400">
                <p>&copy; {% now "Y" %} ChronosLux. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <div id="cart-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
        <div class="fixed right-0 top-0 h-full w-full max-w-md bg-white shadow-xl">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="font-serif font-bold text-xl">Carrito de Compras</h2>
                <button id="close-cart" class="p-2 hover:bg-gray-100 rounded-md">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6">
                <p class="text-gray-500 text-center">Tu carrito está vacío</p>
            </div>
            <div class="border-t p-6">
                <div class="flex items-center justify-between mb-4">
                    <span class="font-semibold text-lg">Total:</span>
                    <span id="cart-total" class="font-serif font-black text-2xl text-primary">$0</span>
                </div>
                <button id="checkout-btn" class="w-full py-3 custom-bg-primary custom-text-primary-foreground font-semibold rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50" disabled>
                    Proceder al Pago
                </button>
            </div>
        </div>
    </div>

    {# === MODAL DE AUTENTICACIÓN (GLOBAL) === #}
    <div id="user-modal" class="fixed inset-0 z-50 hidden">
      <!-- Backdrop (clic para cerrar) -->
      <div id="auth-backdrop" class="absolute inset-0 bg-black/50"></div>

      <!-- Contenedor -->
      <div id="auth-dialog" class="relative mx-auto mt-24 w-full max-w-lg rounded-2xl bg-white shadow-xl">
        <div class="flex items-center justify-between border-b p-4">
          <h2 id="auth-modal-title" class="text-2xl font-bold">
            {% if user.is_authenticated %}Mi cuenta{% else %}Inicio de sesión{% endif %}
          </h2>
          <button id="close-modal" aria-label="Cerrar" class="p-2 hover:bg-gray-100 rounded-lg">✕</button>
        </div>

        <!-- Contenido con scroll interno -->
        <div class="p-6 space-y-10 max-h-[75vh] overflow-y-auto">

          {% if user.is_authenticated %}
            <!-- PANE: PERFIL AUTENTICADO -->
            <div id="profile-pane">
              <div class="space-y-2 mb-4">
                <p class="text-sm text-gray-500">Nombre</p>
                <p class="text-lg font-semibold">{{ user.first_name }} {{ user.last_name }}</p>
                <p class="text-sm text-gray-500 mt-3">Correo</p>
                <p class="text-lg font-mono">{{ user.email }}</p>
              </div>

              <div class="sticky bottom-0 bg-white pt-3">
                <form method="post" action="{% url 'logout' %}">
                  {% csrf_token %}
                  <button type="submit" class="w-full rounded-xl bg-gray-900 text-white py-2 font-semibold">
                    Cerrar sesión
                  </button>
                </form>
              </div>
            </div>

          {% else %}
            <!-- TAB: LOGIN -->
            <div id="login-form-pane">
              <form method="post" action="{% url 'login' %}" class="space-y-4">
                {% csrf_token %}
                {% with form=login_form %}
                  {% if form.non_field_errors %}
                    <p class="text-sm text-red-600">{{ form.non_field_errors|join:", " }}</p>
                  {% endif %}
                  {% for field in form %}
                    <div class="form-field {% if field.errors %}has-error{% endif %}">
                      <label class="block text-sm font-medium mb-1">{{ field.label }}</label>
                      {{ field }}
                      {% if field.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ field.errors|join:", " }}</p>
                      {% endif %}
                    </div>
                  {% endfor %}
                {% endwith %}

                <div class="sticky bottom-0 bg-white pt-3">
                  <button type="submit" class="w-full rounded-xl custom-bg-primary custom-text-primary-foreground py-2 font-semibold">
                    Iniciar sesión
                  </button>
                </div>
              </form>

              <p id="switch-to-register" class="mt-4 text-sm text-center">
                ¿No tienes cuenta?
                <a href="#" class="custom-text-secondary underline">Regístrate</a>
              </p>
            </div>

            <!-- TAB: REGISTRO -->
            <div id="signup-form-pane" class="hidden">
              <form method="post" action="{% url 'signup' %}" class="space-y-4">
                {% csrf_token %}
                {% with form=signup_form %}
                  {% if form.non_field_errors %}
                    <p class="text-sm text-red-600">{{ form.non_field_errors|join:", " }}</p>
                  {% endif %}
                  {% for field in form %}
                    <div class="form-field {% if field.errors %}has-error{% endif %}">
                      <label class="block text-sm font-medium mb-1">{{ field.label }}</label>
                      {{ field }}
                      {% if field.errors and field.name != 'password2' %}
                        {# Ocultamos cualquier error en password2, por si llegara #}
                        <p class="text-sm text-red-600 mt-1">{{ field.errors|join:", " }}</p>
                      {% endif %}
                    </div>
                  {% endfor %}
                {% endwith %}

                <div class="sticky bottom-0 bg-white pt-3">
                  <button type="submit" class="w-full rounded-xl custom-bg-secondary custom-text-secondary-foreground py-2 font-semibold">
                    Registrarme
                  </button>
                </div>
              </form>

              <p id="switch-to-login" class="mt-4 text-sm text-center">
                ¿Ya tienes cuenta?
                <a href="#" class="custom-text-secondary underline">Inicia sesión</a>
              </p>
            </div>
          {% endif %}

        </div>
      </div>
    </div>
    {# === /MODAL DE AUTENTICACIÓN === #}



    <script src="{% static 'js/main.js' %}?v=2"></script>
    {% block extra_js %}{% endblock %}
    <script src="{% static 'js/auth-modal.js' %}?v=1"></script>


    <script>
    // Fallback mínimo: abre/cierra el modal aunque falle main.js
    document.addEventListener('click', function(e){
      if (e.target.closest('#user-icon-btn')) {
        var m = document.getElementById('user-modal');
        if (m) m.classList.remove('hidden');
      }
      if (e.target.closest('#close-modal')) {
        var m = document.getElementById('user-modal');
        if (m) m.classList.add('hidden');
      }
    });
    </script>

</body>
</html>